local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
print("ğŸ¯ Sniper Aimbot Script BaÅŸlatÄ±lÄ±yor...")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")

-- Function to find the closest player (excluding self)
local function getClosestPlayer()
    local closestHead = nil
    local minDist = math.huge
    local myPos = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") 
        and LocalPlayer.Character.HumanoidRootPart.Position 
        or Camera.CFrame.Position
    
    print("\n[HEDEF ARAMA] BaÅŸlatÄ±ldÄ±")
    print("â”œâ”€ Kendi pozisyon: " .. tostring(myPos))
    
    local validTargets = 0
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            if player.Character then
                local head = player.Character:FindFirstChild("Head")
                local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                
                if not head then
                    print("â”œâ”€ âœ— " .. player.Name .. " - Head bulunamadÄ±")
                elseif not humanoid then
                    print("â”œâ”€ âœ— " .. player.Name .. " - Humanoid bulunamadÄ±")
                elseif humanoid.Health <= 0 then
                    print("â”œâ”€ âœ— " .. player.Name .. " - Ã–lÃ¼ (HP: 0)")
                else
                    validTargets = validTargets + 1
                    local dist = (head.Position - myPos).Magnitude
                    print("â”œâ”€ âœ“ " .. player.Name .. " - Mesafe: " .. math.floor(dist) .. " studs")
                    
                    if dist < minDist then
                        minDist = dist
                        closestHead = head
                    end
                end
            else
                print("â”œâ”€ âœ— " .. player.Name .. " - Character yok")
            end
        end
    end
    
    print("â””â”€ Toplam geÃ§erli hedef: " .. validTargets)
    
    if closestHead then
        print("\n[SONUÃ‡] âœ“ En yakÄ±n hedef bulundu!")
        print("â”œâ”€ Oyuncu: " .. closestHead.Parent.Name)
        print("â”œâ”€ Mesafe: " .. math.floor(minDist) .. " studs")
        print("â””â”€ Kafa pozisyonu: " .. tostring(closestHead.Position))
    else
        print("\n[SONUÃ‡] âœ— HiÃ§ geÃ§erli hedef yok!")
    end
    
    return closestHead
end

-- Locate the RemoteFunction
print("\n[KURULUM] RemoteFunction aranÄ±yor...")
local success, FireShotRemote = pcall(function()
    return game:GetService("ReplicatedStorage").Functions.Sniper.FireShot
end)

if not success or not FireShotRemote then
    warn("\n[HATA] âŒ FireShot RemoteFunction bulunamadÄ±!")
    warn("Hata detayÄ±: " .. tostring(FireShotRemote))
    return
end

print("[KURULUM] âœ“ RemoteFunction bulundu: " .. FireShotRemote:GetFullName())

-- Hook the InvokeServer method
print("[KURULUM] Hook kuruluyor...")
local hookSuccess, hookError = pcall(function()
    local oldInvoke = hookfunction(FireShotRemote.InvokeServer, function(self, startPos, lookVec, zoom)
        print("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print("ğŸ”« [ATEÅ] Hook tetiklendi!")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print("\n[ORÄ°JÄ°NAL PARAMETRELER]")
        print("â”œâ”€ StartPos (BaÅŸlangÄ±Ã§): " .. tostring(startPos))
        print("â”œâ”€ LookVec (YÃ¶n): " .. tostring(lookVec))
        print("â””â”€ Zoom: " .. tostring(zoom))
        
        local targetHead = getClosestPlayer()
        
        if targetHead then
            -- Kamera pozisyonundan hedefin kafasÄ±na doÄŸru yÃ¶n hesapla
            local direction = (targetHead.Position - startPos).Unit
            lookVec = direction
            
            print("\n[MODÄ°FÄ°KASYON] âœ“ Parametreler deÄŸiÅŸtirildi!")
            print("â”œâ”€ Hedef: " .. targetHead.Parent.Name)
            print("â”œâ”€ Hedef pozisyon: " .. tostring(targetHead.Position))
            print("â”œâ”€ Yeni LookVec (YÃ¶n): " .. tostring(lookVec))
            print("â”œâ”€ StartPos: " .. tostring(startPos) .. " (DEÄÄ°ÅMEDÄ° - Kamera pozisyonu)")
            print("â””â”€ AÃ§Ä± farkÄ±: ~" .. math.floor(math.deg(math.acos(lookVec:Dot(direction)))) .. "Â°")
        else
            print("\n[MODÄ°FÄ°KASYON] âš  Hedef bulunamadÄ±")
            print("â””â”€ Orijinal parametreler kullanÄ±lÄ±yor")
        end
        
        print("\n[Ã‡AÄRI] RemoteFunction Ã§aÄŸrÄ±lÄ±yor...")
        local startTime = tick()
        local result = oldInvoke(self, startPos, lookVec, zoom)
        local elapsed = (tick() - startTime) * 1000
        
        print("[SONUÃ‡] RemoteFunction yanÄ±t verdi")
        print("â”œâ”€ DÃ¶nÃ¼ÅŸ deÄŸeri: " .. tostring(result))
        print("â””â”€ Ä°ÅŸlem sÃ¼resi: " .. math.floor(elapsed) .. "ms")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n")
        
        return result
    end)
end)

if hookSuccess then
    print("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("âœ… BAÅARILI! Hook kuruldu ve aktif.")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("\nAteÅŸ etmeyi deneyin. TÃ¼m iÅŸlemler loglanacak.\n")
else
    warn("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    warn("âŒ BAÅARISIZ! Hook kurulamadÄ±!")
    warn("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    warn("Hata detayÄ±: " .. tostring(hookError))
end
